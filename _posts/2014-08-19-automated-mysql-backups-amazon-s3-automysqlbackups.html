---
layout: post
title: Automated MySQL Backups to Amazon S3 with AutoMySQLBackups
date: 2014-08-19 12:59:41.000000000 +05:00
type: post
published: true
status: publish
categories:
- Backups
- Databases
- MySQL
tags:
- amazon s3
- automated backups
- crontab
meta:
  _wpcom_is_markdown: '1'
  _edit_last: '1'
  _jetpack_related_posts_cache: a:1:{s:32:"8f6677c9d6b0f903e98ad32ec61f8deb";a:2:{s:7:"expires";i:1487639668;s:7:"payload";a:3:{i:0;a:1:{s:2:"id";i:35;}i:1;a:1:{s:2:"id";i:53;}i:2;a:1:{s:2:"id";i:59;}}}}
  _yoast_wpseo_focuskw: mysql backup to s3
  _yoast_wpseo_metadesc: Learn how to setup automated mysql database backups of the
    whole server and send the backups to Amazon S3.
  _wpas_done_all: '1'
  _yoast_wpseo_linkdex: '59'
author:
  login: aamnah
  email: aamnah@aamnah.com
  display_name: aamnah
  first_name: ''
  last_name: ''
---
<p>This how-to will teach you how to take automated backups of all your MySQL databases and send them to Amazon S3.</p>
<h2>Access (Logins) required</h2>
<ol>
<li>root login for the server (sudo is required to run automysqlbackup, root is req. to add to root userâ€™s cron)</li>
<li>
<p>admin login for the mysql server (to provide for backup config file)</p>
</li>
<li>
<p>IAM access keys to use with s3cmd (to configure s3cmd)</p>
</li>
</ol>
<p>sudo is required to run the AutoMySQLBackup script, so when adding the command to cron, you'd need to add it to the root user's cron (so that it runs successfully on set intervals without asking for a password).</p>
<h2>Tools</h2>
<ol>
<li><a href="http://sourceforge.net/projects/automysqlbackup/">AutoMySQLBackup</a></li>
</ol>
<li>
<p><a href="http://s3tools.org/repositories">s3cmd</a></p>
</li>
<li>
<p>SSH client (Terminal on Mac / <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/">putty</a> on Windows)</p>
</li>
<h2>Installing S3cmd on Debian</h2>
<p>Check the <a href="http://s3tools.org/repositories">Repos</a> page for install on other systems.</p>
<ol>
<li>Import S3tools signing key:<br />
<code>wget -O- -q http://s3tools.org/repo/deb-all/stable/s3tools.key | sudo apt-key add -</code></li>
<li>Add the repo to sources.list:<br />
<code>sudo wget -O/etc/apt/sources.list.d/s3tools.list http://s3tools.org/repo/deb-all/stable/s3tools.list</code></li>
<li>Refresh package cache and install the newest s3cmd:<br />
<code>sudo apt-get update &amp;&amp; sudo apt-get install s3cmd</code></li>
</ol>
<p>Run <code>s3cmd --configure</code> to add IAM access keys for Amazon S3.</p>
<h2>Installing AutoMySQLBackup</h2>
<p>Download and extract the latest tarball and run the install script.<br />
1. Create a directory where you want to download and extract the AutoMySQLBackup file and move to that directory.<br />
<code>sudo mkdir /automysqlbackup &amp;&amp; cd /automysqlbackup</code><br />
2. Download automysqlbackup (v3.0_rc6) to the server. (Check <a href="http://sourceforge.net/projects/automysqlbackup">Sourceforge</a> for the latest version of AutoMySQLBackup. As of this writing v3.0_rc6 is the latest)<br />
<code>wget http://kaz.dl.sourceforge.net/project/automysqlbackup/AutoMySQLBackup/AutoMySQLBackup%20VER%203.0/automysqlbackup-v3.0_rc6.tar.gz</code></p>
<ol>
<li>Extraxt the downloaded tarball <code>tar zxvf automysqlbackup-v3.0_rc6.tar.gz</code> </li>
<li>Run the installer <code>./install.sh</code></li>
</ol>
<p>By default it will install the configuration files in <code>/etc/automysqlbackup</code> and the executable files in <code>/usr/local/bin</code>.</p>
<h2>Configuring AutoMySQLBackup</h2>
<p>Edit the <code>/etc/automysqlbackup/myserver.conf</code> file to customise your settings.<br />
The myserver.conf file is VERY well documented, all you have to do is read and it'll tell you what setting is supposed to do what and how you should configure it. You do not need to edit beyond the basics. What you generally edit are basic settings (username, passsword, host and backup directory), database settings (which ones to backups, which ones to not), rotation settings (when to backup), and notification settings (who and what to tell when a backup is complete).</p>
<pre class="lang:sh decode:true "># Basic Settings

CONFIG_mysql_dump_username='root'
CONFIG_mysql_dump_password='password'
CONFIG_mysql_dump_host='localhost'
CONFIG_mysql_dump_host_friendly='Main MySQL Server'
CONFIG_backup_dir='/backup/db'</pre>
<pre class="lang:sh decode:true "># Databases to backup

# List of databases for Daily/Weekly Backup e.g. ( 'DB1' 'DB2' 'DB3' ... )
# set to (), i.e. empty, if you want to backup all databases
CONFIG_db_names=()

# List of databases for Monthly Backups.
# set to (), i.e. empty, if you want to backup all databases
CONFIG_db_month_names=()

# List of DBNAMES to EXLUCDE if DBNAMES is empty, i.e. ().
CONFIG_db_exclude=( 'information_schema' )</pre>
<pre class="lang:sh decode:true "># Rotation Settings

# Which day do you want backups?
CONFIG_do_monthly="01"
CONFIG_do_weekly="5"

# Set rotation of daily backups.
CONFIG_rotation_daily=7
CONFIG_rotation_weekly=14
CONFIG_rotation_monthly=12</pre>
<pre class="lang:sh decode:true "># Notification setup

# What would you like to be mailed to you?
# - log   : send only log file
# - files : send log file and sql files as attachments (see docs)
# - stdout : will simply output the log to the screen if run manually.
# - quiet : Only send logs if an error occurs to the MAILADDR.
CONFIG_mailcontent='log'

# Email Address to send mail to? (user@domain.com)
CONFIG_mail_address='hello@aamnah.com'</pre>
<h2>Adding AutoMySQLBackup to Cron</h2>
<p>Edit crontab <code>sudo crontab -e</code> and add the following at the end.</p>
<pre class="lang:sh decode:true "># AutoMySQLbackup run command for backing up databases every day at 12:05am.
5 0 * * * sudo automysqlbackup /etc/automysqlbackup/myserver.conf

# Copy backed up databases to Amazon S3 via s3cmd, daily at 5am.
0 5 * * * sudo s3cmd -r sync /backup/location/ s3://location/</pre></p>
