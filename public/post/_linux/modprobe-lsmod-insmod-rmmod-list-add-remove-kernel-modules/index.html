<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.26" />

  <title>[modprobe, lsmod, insmod, rmmod] List, Add, Remove Kernel Modules &middot; TLDR Dev Notes</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href=/css/blackburn.css>

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="/">TLDR Dev Notes</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/post/"><i class='fa fa-list fa-fw'></i>All Notes</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/AamnahAkram" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://instagram.com/AamnahAkram" target="_blank"><i class="fa fa-instagram fa-fw"></i>Instagram</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://pinterest.com/*" target="_blank"><i class="fa fa-pinterest-square fa-fw"></i>Pinterest</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/*" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/yoshiharuyamashita" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://bitbucket.org/*" target="_blank"><i class="fa fa-bitbucket-square fa-fw"></i>Bitbucket</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/*" target="_blank"><i class="fa fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://serverfault.com/users/*" target="_blank"><i class="fa fa-server fa-fw"></i>Server Fault</a>
    </li>
    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2016. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>[modprobe, lsmod, insmod, rmmod] List, Add, Remove Kernel Modules</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>01 Jan 0001, 00:00</time>
  </div>

  

  

  

</div>

  

<p>Building on previous lessons in this section, we will learn how to probe our kernel with the appropriate device driver and determine whether it is loaded and functioning as expected. We will also discuss how we can use the configuration of modprobe to blacklist or prevent some device drivers from loading even if the hardware is present on our system as well as why we might need to do that.</p>

<h3 id="modprobe">modprobe</h3>

<pre><code class="language-bash">modprobe -l # list modules
modprobe -r moduleName # remove modules e.g. `modprobe -r floppy`
modprobe moduleName # insert modules e.g. `modprobe floppy`
</code></pre>

<ul>
<li><code>modprobe -l</code> works on CentOS 6.6 and Ubuntu 12 or before.</li>
<li><code>modprobe</code>, unlike <code>insmod</code> can add modules without specifying complete module file paths. <code>modprobe</code> fully understands where the kernel modules are installed on the system.</li>
<li>When compiling our kernel, we used to be able to use <code>modprobe</code> to not only insert and remove modules but also query (list) the modules that were already installed on the system (by using <code>modprobe -l</code>).</li>
<li><code>modprobe</code> is replaced by <code>lsmod</code> in modern systems (CentOS 7, RHEL 7, Ubuntu 13+, basically any modern distribution that has come out in late 2014, early 2015). We can still use <code>modprobe</code> to remove modules though.</li>
<li>Modern systems are unifying the toolset into anything that lists modules or hardware or devices on your system is now part of the <code>ls</code> type kernel and system management tools, like <code>lspci</code> (all the PCI devices that are connected), <code>lsusb</code> (all the USB devices that are connected), and in this case <code>lsmod</code> is replacing <code>modprobe -l</code>.</li>
<li><code>modprobe</code> still works for adding and removing modules but we can no longer use it to list modules that are installed or available on our system.</li>
</ul>

<h3 id="lsmod">lsmod</h3>

<ul>
<li><code>lsmod</code> is what we use to look for kernel modules that are installed on our system. It tells us what modules are installed and we can grep for different modules as well. It will not tell us all of the modules that are <em>available</em> on our system, like <code>modprobe -l</code> did.</li>
<li><code>lsmod</code> nicely formats the info that is listed in <em>/proc/modules</em></li>
<li>You can use the <code>grep</code> utility to look for particular modules, like the sound modules for example:</li>
</ul>

<pre><code class="language-bash">lsmod | grep snd
</code></pre>

<ul>
<li>The <code>lsmod</code> is a very basic utility for listing modules, it has no advanced options or flags. It hides the hexadecimal info (that we generally won&rsquo;t care about) which is in the actual <em>/proc/modules</em> file. <em>/proc/modules</em> has the same info in a space delimited format that is read by various utilities like <code>insmod</code>, <code>modprobe</code>, <code>lsmod</code> etc.</li>
</ul>

<p><img src="/assets/img/resources/A3B138BA-581C-4001-84CD-404E4819DD3B.png" alt="lsmod" /></p>

<p>You can grep <em>/proc/modules</em> just like you can grep <code>lsmod</code>.</p>

<p><img src="/assets/img/resources/43BBFEF5-A698-43A4-9BF1-1D56B0ED26E5.png" alt="grep /proc/modules" /></p>

<h3 id="insmod">insmod</h3>

<ul>
<li><code>insmod</code> = <strong>Ins</strong>ert <strong>Mod</strong>ule.</li>
<li><code>modprobe moduleName</code> still works for adding modules and is simpler to use. Use <code>modprobe</code>, <code>insmod</code> is a chore.</li>
<li><code>insmod</code> needs a full path to the actiual binary object file that&rsquo;s loaded into the kernel. <code>insmod</code> is not smart enough, nor is it configured by default, to look for the kernel object without passing in a full path.</li>
</ul>

<p>An example command would be like this:</p>

<pre><code class="language-bash">insmod /lib/modules/Kernel-Version/kernel/drivers/block/floppy.ko

insmod /lib/modules/3.13.0-40-generic/kernel/drivers/block/floppy.ko
</code></pre>

<h3 id="rmmod">rmmod</h3>

<ul>
<li><code>rmmod</code> = <strong>R</strong>e<strong>m</strong>ove <strong>Mod</strong>ule</li>
<li><code>rmmod</code> does not require a full path because it looks at the current kernel objects that are running</li>
<li><code>modprobe -r moduleName</code> still works for removing modules.</li>
</ul>

<h4 id="misc-commands">Misc. Commands</h4>

<ul>
<li>check CentOS  version: <code>cat /etc/issue</code></li>
<li>check kernel version: <code>uname -a</code></li>
</ul>

<h2 id="links">Links</h2>

<ul>
<li><a href="https://linuxacademy.com/cp/courses/lesson/course/26/lesson/4/module/1">Linux Academy: Linux+ LPIC Level 1 Exam 1</a></li>
</ul>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="/post/_commands/scp-secure-copy/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="/post/_commands/scp-secure-copy/">[scp] Secure Copy</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="/post/_commands/last-find-out-login-details/">[last] Find out login details</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="/post/_commands/last-find-out-login-details/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'Your Disqus shortname';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</div>

</div>
</div>
<script src="/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'Your Google Analytics tracking ID', 'auto');
  ga('send', 'pageview');

</script>



</body>
</html>

