<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1, shrink-to-fit=no minimum-scale=1'>
  <title>TLDR Dev Notes</title>
  <link rel='stylesheet' href='/css/main.css'> 
  <link rel="stylesheet" href="/prism/prism.css">
</head>
<body>

  
<header id="header">
  <div id="logo">
    <h1>TLDR Dev Notes</h1>
  </div>

  <nav id="main-nav">
    
      
        <a href="/">Home</a>
      
        <a href="/about/">About</a>
      
        <a href="/contact/">Contact</a>
      
        <a href="/quotes/">Quotes</a>
      
        <a href="/resources/">Resources</a>
      
        <a href="/progress/">What i did</a>
      
    
  </nav>

</header>


  
  <div id="sidebar">
  <h6>Sections</h6>
  
  <ul id="list-sections">
    
      <li><a href="/api/">
        
        APIs
        </a></li>
    
      <li><a href="/aws/">
        
        Amazon Web Services (AWS)
        </a></li>
    
      <li><a href="/bash-scripting/">
        
        Bash Scripting
        </a></li>
    
      <li><a href="/css-sass/">
        
        CSS &amp; Sass
        </a></li>
    
      <li><a href="/cheatsheets/">
        
        Cheatsheets
        </a></li>
    
      <li><a href="/commands/">
        
        Commands
        </a></li>
    
      <li><a href="/databases/">
        
        Databases
        </a></li>
    
      <li><a href="/drafts/">
        
        Drafts
        </a></li>
    
      <li><a href="/git-github/">
        
        Git &amp; Github
        </a></li>
    
      <li><a href="/javascript/">
        
        JavaScript
        </a></li>
    
      <li><a href="/jekyll/">
        
        Jekyll
        </a></li>
    
      <li><a href="/linux/">
        
        Linux
        </a></li>
    
      <li><a href="/misc/">
        
        Misc
        </a></li>
    
      <li><a href="/node-api/">
        
        Node-api
        </a></li>
    
      <li><a href="/nodejs/">
        
        Node.js
        </a></li>
    
      <li><a href="/opencart/">
        
        OpenCart
        </a></li>
    
      <li><a href="/php/">
        
        PHP
        </a></li>
    
      <li><a href="/programming/">
        
        Programming
        </a></li>
    
      <li><a href="/python/">
        
        Python
        </a></li>
    
      <li><a href="/quotes/">
        
        Quotes
        </a></li>
    
      <li><a href="/raspberrypi/">
        
        Raspberry Pi
        </a></li>
    
      <li><a href="/reactjs/">
        
        Reactjs
        </a></li>
    
      <li><a href="/redux/">
        
        Redux
        </a></li>
    
      <li><a href="/resources/">
        
        Resources
        </a></li>
    
      <li><a href="/sysadmin/">
        
        System Administration
        </a></li>
    
      <li><a href="/webdev/">
        
        Web Development
        </a></li>
    
      <li><a href="/workflow/">
        
        Workflow
        </a></li>
    
      <li><a href="/ios-swift/">
        
        iOS &amp; Swift
        </a></li>
    
        </ul>

  
  <section>
    <h6>Tags</h6>
    
      <a href="/tags/amazon-rds">amazon-rds</a>, 
    
      <a href="/tags/amazon-s3">amazon-s3</a>, 
    
      <a href="/tags/api">api</a>, 
    
      <a href="/tags/array-methods">array-methods</a>, 
    
      <a href="/tags/aws">aws</a>, 
    
      <a href="/tags/babel">babel</a>, 
    
      <a href="/tags/backups">backups</a>, 
    
      <a href="/tags/bash">bash</a>, 
    
      <a href="/tags/basics">basics</a>, 
    
      <a href="/tags/bluetooth">bluetooth</a>, 
    
      <a href="/tags/cheatsheet">cheatsheet</a>, 
    
      <a href="/tags/cli">cli</a>, 
    
      <a href="/tags/commands">commands</a>, 
    
      <a href="/tags/compass">compass</a>, 
    
      <a href="/tags/concepts">concepts</a>, 
    
      <a href="/tags/coreblueooth">coreblueooth</a>, 
    
      <a href="/tags/crontab">crontab</a>, 
    
      <a href="/tags/css">css</a>, 
    
      <a href="/tags/database">database</a>, 
    
      <a href="/tags/databases">databases</a>, 
    
      <a href="/tags/date">date</a>, 
    
      <a href="/tags/debian">debian</a>, 
    
      <a href="/tags/editor">editor</a>, 
    
      <a href="/tags/education">education</a>, 
    
      <a href="/tags/es2015">es2015</a>, 
    
      <a href="/tags/firebase">firebase</a>, 
    
      <a href="/tags/format">format</a>, 
    
      <a href="/tags/free">free</a>, 
    
      <a href="/tags/fundamentals">fundamentals</a>, 
    
      <a href="/tags/getting-started">getting-started</a>, 
    
      <a href="/tags/git">git</a>, 
    
      <a href="/tags/github-pages">github-pages</a>, 
    
      <a href="/tags/guides">guides</a>, 
    
      <a href="/tags/hacking">hacking</a>, 
    
      <a href="/tags/hosting">hosting</a>, 
    
      <a href="/tags/how-to">how-to</a>, 
    
      <a href="/tags/hugo">hugo</a>, 
    
      <a href="/tags/ios">ios</a>, 
    
      <a href="/tags/javascript">javascript</a>, 
    
      <a href="/tags/jekyll">jekyll</a>, 
    
      <a href="/tags/js">js</a>, 
    
      <a href="/tags/keychain">keychain</a>, 
    
      <a href="/tags/lamp">lamp</a>, 
    
      <a href="/tags/lfs">lfs</a>, 
    
      <a href="/tags/linux">linux</a>, 
    
      <a href="/tags/macos">macos</a>, 
    
      <a href="/tags/markdown">markdown</a>, 
    
      <a href="/tags/media-queries">media-queries</a>, 
    
      <a href="/tags/mongodb">mongodb</a>, 
    
      <a href="/tags/mysql">mysql</a>, 
    
      <a href="/tags/nagios">nagios</a>, 
    
      <a href="/tags/node">node</a>, 
    
      <a href="/tags/nodejs">nodejs</a>, 
    
      <a href="/tags/npm">npm</a>, 
    
      <a href="/tags/opencart">opencart</a>, 
    
      <a href="/tags/phpmyadmin">phpmyadmin</a>, 
    
      <a href="/tags/programming">programming</a>, 
    
      <a href="/tags/python">python</a>, 
    
      <a href="/tags/raspberry-pi">raspberry-pi</a>, 
    
      <a href="/tags/react">react</a>, 
    
      <a href="/tags/react-router">react-router</a>, 
    
      <a href="/tags/reactjs">reactjs</a>, 
    
      <a href="/tags/redux">redux</a>, 
    
      <a href="/tags/s3">s3</a>, 
    
      <a href="/tags/sass">sass</a>, 
    
      <a href="/tags/script">script</a>, 
    
      <a href="/tags/scripts">scripts</a>, 
    
      <a href="/tags/snippets">snippets</a>, 
    
      <a href="/tags/sql">sql</a>, 
    
      <a href="/tags/ssh">ssh</a>, 
    
      <a href="/tags/steganography">steganography</a>, 
    
      <a href="/tags/sublime-text">sublime-text</a>, 
    
      <a href="/tags/sync">sync</a>, 
    
      <a href="/tags/sysadmin">sysadmin</a>, 
    
      <a href="/tags/system-management">system-management</a>, 
    
      <a href="/tags/table">table</a>, 
    
      <a href="/tags/terminal">terminal</a>, 
    
      <a href="/tags/ubuntu">ubuntu</a>, 
    
      <a href="/tags/wifi">wifi</a>, 
    
      <a href="/tags/wordpress">wordpress</a>, 
    
      <a href="/tags/workflow">workflow</a>, 
    
  </section>

  <section>
    <h6>Most Used Tags</h6>
    
      <a href="/tags/linux">linux</a>,
    
      <a href="/tags/es2015">es2015</a>,
    
      <a href="/tags/how-to">how-to</a>,
    
      <a href="/tags/array-methods">array-methods</a>,
    
      <a href="/tags/bash">bash</a>,
    
      <a href="/tags/commands">commands</a>,
    
      <a href="/tags/cheatsheet">cheatsheet</a>,
    
      <a href="/tags/concepts">concepts</a>,
    
      <a href="/tags/mysql">mysql</a>,
    
      <a href="/tags/free">free</a>,
    
      <a href="/tags/sass">sass</a>,
    
      <a href="/tags/compass">compass</a>,
    
      <a href="/tags/python">python</a>,
    
      <a href="/tags/backups">backups</a>,
    
      <a href="/tags/editor">editor</a>,
    
      <a href="/tags/hugo">hugo</a>,
    
      <a href="/tags/opencart">opencart</a>,
    
      <a href="/tags/raspberry-pi">raspberry-pi</a>,
    
      <a href="/tags/basics">basics</a>,
    
      <a href="/tags/database">database</a>,
    
  </section>


</div>


  
  <div id="main">


<h1 class="post_title">[modprobe, lsmod, insmod, rmmod] List, Add, Remove Kernel Modules</h1>


<div class="post_meta">
  
    
    
  
    
    
    
      <div class="meta_date"><strong>Last updated on:</strong> Mar 13, 2017</div>
    
  
    
    
    <div class="meta_section"><strong>Section:</strong> 
      
        <a href="/linux">Linux</a>
          
    </div>


    
    
  
  </div>



<div class="content">
    

<p>Building on previous lessons in this section, we will learn how to probe our kernel with the appropriate device driver and determine whether it is loaded and functioning as expected. We will also discuss how we can use the configuration of modprobe to blacklist or prevent some device drivers from loading even if the hardware is present on our system as well as why we might need to do that.</p>

<h3 id="modprobe">modprobe</h3>

<pre><code class="language-bash">modprobe -l # list modules
modprobe -r moduleName # remove modules e.g. `modprobe -r floppy`
modprobe moduleName # insert modules e.g. `modprobe floppy`
</code></pre>

<ul>
<li><code>modprobe -l</code> works on CentOS 6.6 and Ubuntu 12 or before.</li>
<li><code>modprobe</code>, unlike <code>insmod</code> can add modules without specifying complete module file paths. <code>modprobe</code> fully understands where the kernel modules are installed on the system.</li>
<li>When compiling our kernel, we used to be able to use <code>modprobe</code> to not only insert and remove modules but also query (list) the modules that were already installed on the system (by using <code>modprobe -l</code>).</li>
<li><code>modprobe</code> is replaced by <code>lsmod</code> in modern systems (CentOS 7, RHEL 7, Ubuntu 13+, basically any modern distribution that has come out in late 2014, early 2015). We can still use <code>modprobe</code> to remove modules though.</li>
<li>Modern systems are unifying the toolset into anything that lists modules or hardware or devices on your system is now part of the <code>ls</code> type kernel and system management tools, like <code>lspci</code> (all the PCI devices that are connected), <code>lsusb</code> (all the USB devices that are connected), and in this case <code>lsmod</code> is replacing <code>modprobe -l</code>.</li>
<li><code>modprobe</code> still works for adding and removing modules but we can no longer use it to list modules that are installed or available on our system.</li>
</ul>

<h3 id="lsmod">lsmod</h3>

<ul>
<li><code>lsmod</code> is what we use to look for kernel modules that are installed on our system. It tells us what modules are installed and we can grep for different modules as well. It will not tell us all of the modules that are <em>available</em> on our system, like <code>modprobe -l</code> did.</li>
<li><code>lsmod</code> nicely formats the info that is listed in <em>/proc/modules</em></li>
<li>You can use the <code>grep</code> utility to look for particular modules, like the sound modules for example:</li>
</ul>

<pre><code class="language-bash">lsmod | grep snd
</code></pre>

<ul>
<li>The <code>lsmod</code> is a very basic utility for listing modules, it has no advanced options or flags. It hides the hexadecimal info (that we generally won&rsquo;t care about) which is in the actual <em>/proc/modules</em> file. <em>/proc/modules</em> has the same info in a space delimited format that is read by various utilities like <code>insmod</code>, <code>modprobe</code>, <code>lsmod</code> etc.</li>
</ul>

<p><img src="/assets/img/resources/A3B138BA-581C-4001-84CD-404E4819DD3B.png" alt="lsmod" /></p>

<p>You can grep <em>/proc/modules</em> just like you can grep <code>lsmod</code>.</p>

<p><img src="/assets/img/resources/43BBFEF5-A698-43A4-9BF1-1D56B0ED26E5.png" alt="grep /proc/modules" /></p>

<h3 id="insmod">insmod</h3>

<ul>
<li><code>insmod</code> = <strong>Ins</strong>ert <strong>Mod</strong>ule.</li>
<li><code>modprobe moduleName</code> still works for adding modules and is simpler to use. Use <code>modprobe</code>, <code>insmod</code> is a chore.</li>
<li><code>insmod</code> needs a full path to the actiual binary object file that&rsquo;s loaded into the kernel. <code>insmod</code> is not smart enough, nor is it configured by default, to look for the kernel object without passing in a full path.</li>
</ul>

<p>An example command would be like this:</p>

<pre><code class="language-bash">insmod /lib/modules/Kernel-Version/kernel/drivers/block/floppy.ko

insmod /lib/modules/3.13.0-40-generic/kernel/drivers/block/floppy.ko
</code></pre>

<h3 id="rmmod">rmmod</h3>

<ul>
<li><code>rmmod</code> = <strong>R</strong>e<strong>m</strong>ove <strong>Mod</strong>ule</li>
<li><code>rmmod</code> does not require a full path because it looks at the current kernel objects that are running</li>
<li><code>modprobe -r moduleName</code> still works for removing modules.</li>
</ul>

<h4 id="misc-commands">Misc. Commands</h4>

<ul>
<li>check CentOS  version: <code>cat /etc/issue</code></li>
<li>check kernel version: <code>uname -a</code></li>
</ul>

<h2 id="links">Links</h2>

<ul>
<li><a href="https://linuxacademy.com/cp/courses/lesson/course/26/lesson/4/module/1" target="_blank">Linux Academy: Linux+ LPIC Level 1 Exam 1</a></li>
</ul>

</div>








<footer id="footer">
<hr>
  <section>
    Please note that this site and the posts on it are, and will always be, a work in progress. If i waited for perfection, i’d never get anything done.
  </section>
  <span class="copyright"> Copyright &copy; 2014 - 2016 Aamnah. All rights reserved.</span>
</footer>

</div>

<script src='/prism/prism.js'></script>
</body>
</html>